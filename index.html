<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RentEase - Property Management</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js "></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js "></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js "></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js "></script>
  <style>
    /* Same CSS as before */
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f3f4f6; color: #111827; }
    header, .login-form, .container, footer, table, .tenant-list, .form-group, button, input, select, .card, .grid { /* Paste previous styles here */ }
  </style>
</head>
<body>
   

<!-- Login Form -->
<div id="loginForm" class="container" style="display:none;">
  <h2>Admin Login</h2>
  <div class="card">
    <input type="email" id="loginEmail" placeholder="Email" />
    <input type="password" id="loginPassword" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- Main App -->
<div id="app" style="display:none;">
  <!-- Your full RentEase app HTML goes here -->
  <!-- Copy the entire app HTML from earlier -->
</div>

<!-- Main App -->
<div id="app" style="display:none;">
  <!-- Your full RentEase app HTML goes here -->
</div>

<script>
  // ✅ Firebase Configuration (Replace with your actual values)
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBEXl6GKDmnAg1FbiaKwP1UgiXz2gFTC3w",
  authDomain: "st-loise-rental.firebaseapp.com",
  projectId: "st-loise-rental",
  storageBucket: "st-loise-rental.firebasestorage.app",
  messagingSenderId: "999179801677",
  appId: "1:999179801677:web:9e49dc4d508cb17dbef804",
  measurementId: "G-YBXCCVWN1C"
};

  // ✅ Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // 🔐 Auth State Handler
  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      loadData(); // Load data from Firestore
    } else {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('app').style.display = 'none';
    }
  });

  function login() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    auth.signInWithEmailAndPassword(email, password)
      .catch(error => alert("Login failed: " + error.message));
  }

  function logout() {
    auth.signOut();
  }

  let tenants = [], payments = [];

  function loadData() {
    db.collection("tenants").onSnapshot(snapshot => {
      tenants = [];
      snapshot.forEach(doc => tenants.push({ id: doc.id, ...doc.data() }));
      renderTenants();
      updateDashboard();
      populateTenantDropdown();
    });

    db.collection("payments").onSnapshot(snapshot => {
      payments = [];
      snapshot.forEach(doc => payments.push({ id: doc.id, ...doc.data() }));
      renderPayments();
      updateDashboard();
    });
  }

  function saveTenant(tenant) {
    db.collection("tenants").doc(tenant.id.toString()).set(tenant);
  }

  function savePayment(payment) {
    db.collection("payments").doc(payment.id.toString()).set(payment);
  }

  function removeTenantFromDB(id) {
    db.collection("tenants").doc(id.toString()).delete();
    db.collection("payments").where("tenantId", "==", parseInt(id)).get()
      .then(snapshot => {
        snapshot.forEach(doc => doc.ref.delete());
      });
  }

  // Replace addTenant(), recordPayment(), removeTenant() to use Firebase
  window.addTenant = () => {
    const fullName = document.getElementById('fullName').value.trim();
    const idNumber = document.getElementById('idNumber').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    const unitIndex = parseInt(document.getElementById('unitIndex').value);

    if (!fullName || !idNumber || !phone || isNaN(unitIndex)) return alert("Please fill all required fields.");

    const newTenant = {
      id: Date.now().toString(),
      fullName,
      idNumber,
      phone,
      email,
      unitIndex
    };

    saveTenant(newTenant);
    clearForm();
  };

  window.recordPayment = () => {
    const tenantId = document.getElementById('tenantId').value;
    const amount = document.getElementById('amount').value.trim();
    const paymentDate = document.getElementById('paymentDate').value;
    const monthPaidFor = document.getElementById('monthPaidFor').value;
    const modeOfPayment = document.getElementById('modeOfPayment').value;

    if (!tenantId || !amount) return alert("Please select tenant and enter amount.");

    const newPayment = {
      id: Date.now().toString(),
      tenantId: parseInt(tenantId),
      amount,
      paymentDate,
      monthPaidFor,
      modeOfPayment
    };

    savePayment(newPayment);
    generateReceipt(newPayment);
    clearPaymentForm();
  };

  window.removeTenant = (tenantId) => {
    if (confirm("Are you sure you want to remove this tenant?")) {
      removeTenantFromDB(tenantId);
    }
  };

  // Implement the rest of your functions using tenants/payments arrays
  // e.g., updateDashboard(), renderTenants(), calculateBalance(), etc.
</script>

</body>
</html>
